---
title: "Mantel test Galapagos - Floristic & Currents conectivity"
output:
  html_notebook: default
  word_document: default
Author: Alexandre Fuster and Guillem Pocull
---

In this script, we will convert the obtained floristic and currents matrices (floristic dissimilatiry matrix and oceanic current connectivity matrix) into distance matrices and perform a Procrustes analyses to explore their correlation and answer whether highly sea-current-connected islands more floristicaly similar. 

We will also analyze whether floristic similarities are related to geographic, area, and age distance between islands.

```{r}
library(ade4)
library(qgraph)
library(ecodist)
library(vegan)
library(tidyverse)
library(cluster)
library(textshape)
library(dplyr)
library(tidyverse)
library(cluster)
library(spaa)

source("../Script/Functions.R")
```


### Load data



#### Load floristic matrices and convert to distance objects

```{r}


# All species
distflor_all_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_gal")

distflor_all_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_can")

distflor_all_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_az")

# non-adapted
distflor_nonad_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_non_adapted_gal")

distflor_nonad_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_non_adapted_can")

distflor_nonad_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_non_adapted_az")


# Thalassocorous

distflor_tha_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_thalassochory_gal")

distflor_tha_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_thalassochory_can")

distflor_tha_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_thalassochory_az")


# Fleshy fruited

distflor_freshy_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_fleshy_fruits_gal")


# Littoral

distflor_litt_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_littoral_gal")

distflor_litt_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_littoral_can")

distflor_litt_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_littoral_az")



# Littoral exclusive

distflor_litt.excl_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_littoral_exclusive_gal")

distflor_litt.excl_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_littoral_exclusive_can")

distflor_litt.excl_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_littoral_exclusive_az")



# All but thalassochorous

distflor_no.tha_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_thalassochory_gal")

distflor_no.tha_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_thalassochory_can")

distflor_no.tha_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_thalassochory_az")




# All but littoral

distflor_no.litt_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_littoral_gal")

distflor_no.litt_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_littoral_can")

distflor_no.litt_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_littoral_az")



# All but littoral exlusive

distflor_no.littexcl_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_littoral_exclusive_gal")

distflor_no.littexcl_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_littoral_exclusive_can")

distflor_no.littexcl_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_littoral_exclusive_az")



 # All but fleshy fruited 

distflor_no.fleshy_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_fleshy_gal")



```



#### Load currents and geographic matrices and convert to distance objects

```{r}

# Currents distance matrix

dist_curr_gal<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Galapagos/Matrices-Currents_Galap/matrix_median_min_final_Galapagos.csv")

dist_curr_can<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Canaries/Matrices-Currents_Canaries/matrix_median_min_final_Canaries.csv")

dist_curr_az<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Azores/Matrices-Currents_Azores/matrix_median_min_final_Azores.csv")
  


# Geographic distance matrix


dist_geo_gal<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Galapagos/Matrices-Geographic_Galap/geographic_distance_galap.csv")

dist_geo_can<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Canaries/Matrices-Geographic_Canaries/geographic_distance_canaries.csv")

dist_geo_az<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Azores/Matrices-Geographic_Azores/geographic_distance_azores.csv")

```





#### Load island area matrices and convert to distance objects

Here we first open the file to calculate euclidean distances, and save it with write.table function to make it as we want

```{r}
df_area<-read.csv("../Data/Data_Galapagos/area_islands_galap.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Galapagos/Area_islands_Galapagos",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_gal<-read.table("../Data/Data_Galapagos/Area_islands_Galapagos")




df_area<-read.csv("../Data/Data_Canaries/area_islands_canaries.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Canaries/Area_islands_Canaries",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_can<-read.table("../Data/Data_Canaries/Area_islands_Canaries")





df_area<-read.csv("../Data/Data_Azores/area_islands_azores.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Azores/Area_islands_Azores",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_az<-read.table("../Data/Data_Azores/Area_islands_Azores")
```


```{r}
dist_area_gal<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Galapagos/Area_islands_Galapagos")

dist_area_can<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Canaries/Area_islands_Canaries")

dist_area_az<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Azores/Area_islands_Azores")
```




#### Load island age matrices and convert to distance objects

```{r}

df_Ages<-read.csv("../Data/Data_Galapagos/df_ages_Galap.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Galapagos/Ages_islands_Galapagos",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_gal<-read.table("../Data/Data_Galapagos/Ages_islands_Galapagos")




df_Ages<-read.csv("../Data/Data_Canaries/df_ages_canaries.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Canaries/Ages_islands_Canaries",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_can<-read.table("../Data/Data_Canaries/Ages_islands_Canaries")




df_Ages<-read.csv("../Data/Data_Azores/df_ages_azores.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Azores/Ages_islands_Azores",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_az<-read.table("../Data/Data_Azores/Ages_islands_Azores")
```

```{r}
dist_age_gal<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Galapagos/Ages_islands_Galapagos")

dist_age_can<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Canaries/Ages_islands_Canaries")

dist_age_az<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Azores/Ages_islands_Azores")
```






# Procrustes test




## Floras - currents

```{r}

# All species

protest_curr_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_curr_az,k=8)


# Non-adapted

protest_curr_Flornonad_gal <-Compute_Protest_distMat(distMat_rot=distflor_nonad_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_Flornonad_can <-Compute_Protest_distMat(distMat_rot=distflor_nonad_can,distMat_base = dist_curr_can, k=6)
protest_curr_Flornonad_az <-Compute_Protest_distMat(distMat_rot=distflor_nonad_az,distMat_base = dist_curr_az,k=8)

# Thalassochorous

protest_curr_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_tha_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_curr_can, k=6)
protest_curr_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_curr_az,k=8)


# Littoral

protest_curr_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_curr_az,k=8)


# Littoral exclusive

protest_curr_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_curr_az,k=8)


# Fleshy fruitted

protest_curr_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_curr_gal,k=11)



# All but thalassochorous

protest_curr_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_curr_az,k=8)


# All but Littoral


protest_curr_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_curr_az,k=8)


# All but Littoral exclusive

protest_curr_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_curr_az,k=8)



```


### Plot the results

This chunk saves procrustes tests in the local repository file "plots". It can be ignored for the analyses.


Plots are Kind 1, which gives a visual indication of the degree of match between the two ordinations. Symbols or labels show the position of the samples in the first ordination, and arrows point to their positions in the target ordination. The plot also shows the rotation between the two ordinations necessary to make them match as closely as possible


```{r}
  
# All

pdf(file= "plots/procrustes/protest_curr_FlorAll_gal.pdf" )
plot(protest_curr_FlorAll_gal, kind=1, type = "text",cex = 1.2, main = "Currents & All plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorAll_can.pdf" )
plot(protest_curr_FlorAll_can,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorAll_az.pdf" )
plot(protest_curr_FlorAll_az,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)




# Thalassochorous

pdf(file= "plots/procrustes/protest_curr_Flortha_gal.pdf" )
plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_Flortha_can.pdf" )
plot(protest_curr_Flortha_can,kind=1, type = "text",cex = 1.2,main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_Flortha_az.pdf" )
plot(protest_curr_Flortha_az,kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)


# Littoral

pdf(file= "plots/procrustes/protest_curr_FlorLitt_gal.pdf" )
plot(protest_curr_FlorLitt_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt_can.pdf" )
plot(protest_curr_FlorLitt_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt_az.pdf" )
plot(protest_curr_FlorLitt_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)


# Littoral exclusive

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_gal.pdf" )
plot(protest_curr_FlorLitt.excl_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_can.pdf" )
plot(protest_curr_FlorLitt.excl_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_az.pdf" )
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)


# Fleshy fruited

pdf(file= "plots/procrustes/protest_curr_Florflesh_gal.pdf" )
plot(protest_curr_Florflesh_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Fleshy fruited plants", ar.col = "red1", len = 0.2)

```


Plots

```{r}
par(mfrow=c(2,3))

plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Florflesh_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Fleshy fruited plants", ar.col = "red1", len = 0.2)
```


```{r}

par(mfrow=c(2,2))


plot(protest_curr_FlorAll_can,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_can,kind=1, type = "text",cex = 1.2,main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

```

```{r}

par(mfrow=c(2,2))


plot(protest_curr_FlorAll_az,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_az,kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)
```


## Floras - geo


```{r}
# All species

protest_geo_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_geo_az,k=8)

# Non-adapted

protest_geo_Flornonad_gal <-Compute_Protest_distMat(distMat_rot=distflor_nonad_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_Flornonad_can <-Compute_Protest_distMat(distMat_rot=distflor_nonad_can,distMat_base = dist_geo_can, k=6)
protest_geo_Flornonad_az <-Compute_Protest_distMat(distMat_rot=distflor_nonad_az,distMat_base = dist_geo_az,k=8)

# Thalassochorous

protest_geo_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_geo_can, k=6)
protest_geo_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_geo_az,k=8)


# Littoral

protest_geo_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_geo_az,k=8)


# Littoral exclusive

protest_geo_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_geo_az,k=8)


# Fleshy fruitted

protest_geo_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_geo_gal,k=11)



# All but thalassochorous

protest_geo_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_geo_az,k=8)


# All but Littoral


protest_geo_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_geo_az,k=8)


# All but Littoral exclusive

protest_geo_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_geo_az,k=8)

```




## Floras - Area

```{r}
# All species

protest_area_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_area_can, k=6)
protest_area_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_area_az,k=8)


# Non-adapted

protest_area_Flornonad_gal <-Compute_Protest_distMat(distMat_rot=distflor_nonad_gal,distMat_base = dist_area_gal,k=11)
protest_area_Flornonad_can <-Compute_Protest_distMat(distMat_rot=distflor_nonad_can,distMat_base = dist_area_can, k=6)
protest_area_Flornonad_az <-Compute_Protest_distMat(distMat_rot=distflor_nonad_az,distMat_base = dist_area_az,k=8)


# Thalassochorous

protest_area_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_area_gal,k=11)
protest_area_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_area_can, k=6)
protest_area_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_area_az,k=8)


# Littoral

protest_area_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_area_can, k=6)
protest_area_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_area_az,k=8)


# Littoral exclusive

protest_area_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_area_can, k=6)
protest_area_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_area_az,k=8)


# Fleshy fruitted

protest_area_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_area_gal,k=11)



# All but thalassochorous

protest_area_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_area_az,k=8)


# All but Littoral


protest_area_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_area_az,k=8)


# All but Littoral exclusive

protest_area_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_area_az,k=8)

```


## Floras - Ages

```{r}
# All species

protest_age_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_age_gal ,k=11)
protest_age_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_age_can, k=6)
protest_age_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_age_az,k=8)


# Non-adapted

protest_age_Flornonad_gal <-Compute_Protest_distMat(distMat_rot=distflor_nonad_gal,distMat_base = dist_age_gal,k=11)
protest_age_Flornonad_can <-Compute_Protest_distMat(distMat_rot=distflor_nonad_can,distMat_base = dist_age_can, k=6)
protest_age_Flornonad_az <-Compute_Protest_distMat(distMat_rot=distflor_nonad_az,distMat_base = dist_age_az,k=8)

# Thalassochorous

protest_age_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_age_gal,k=11)
protest_age_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_age_can, k=6)
protest_age_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_age_az,k=8)


# Littoral

protest_age_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_age_can, k=6)
protest_age_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_age_az,k=8)


# Littoral exclusive

protest_age_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_age_can, k=6)
protest_age_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_age_az,k=8)


# Fleshy fruitted

protest_age_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_age_gal,k=11)



# All but thalassochorous

protest_age_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_age_az,k=8)


# All but Littoral


protest_age_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_age_az,k=8)


# All but Littoral exclusive

protest_age_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_age_az,k=8)

```











## Results



###Currents and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Nonad", "Tha", "Litt","Litt.excl")



pvalue_gal <- c(protest_curr_FlorAll_gal$signif,
                protest_curr_Flornonad_gal$signif,
                     protest_curr_Flortha_gal$signif,
                     protest_curr_FlorLitt_gal$signif,
                     protest_curr_FlorLitt.excl_gal$signif)

pvalue_can <- c(protest_curr_FlorAll_can$signif,
                protest_curr_Flornonad_can$signif,
                     protest_curr_Flortha_can$signif,
                     protest_curr_FlorLitt_can$signif,
                     protest_curr_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_curr_FlorAll_az$signif,
               protest_curr_Flornonad_az$signif,
                     protest_curr_Flortha_az$signif,
                     protest_curr_FlorLitt_az$signif,
                     protest_curr_FlorLitt.excl_az$signif)

corr_gal <- c(protest_curr_FlorAll_gal$t0,
              protest_curr_Flornonad_gal$t0,
                     protest_curr_Flortha_gal$t0,
                     protest_curr_FlorLitt_gal$t0,
                     protest_curr_FlorLitt.excl_gal$t0)

corr_can <- c(protest_curr_FlorAll_can$t0,
              protest_curr_Flornonad_can$t0,
                     protest_curr_Flortha_can$t0,
                     protest_curr_FlorLitt_can$t0,
                     protest_curr_FlorLitt.excl_can$t0)


corr_az <- c(protest_curr_FlorAll_az$t0,
             protest_curr_Flornonad_az$t0,
                     protest_curr_Flortha_az$t0,
                     protest_curr_FlorLitt_az$t0,
                     protest_curr_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1)=c("All","Nonad","Tha",
                                "Litt","Litt.excl")
results_procrustes1 

write.csv(results_procrustes1,"../Results/results_currents_floras.csv")

```


### Geo and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Nonad", "Tha", "Litt","Litt.excl")



pvalue_gal <- c(protest_geo_FlorAll_gal$signif,
                protest_geo_Flornonad_gal$signif,
                     protest_geo_Flortha_gal$signif,
                     protest_geo_FlorLitt_gal$signif,
                     protest_geo_FlorLitt.excl_gal$signif)

pvalue_can <- c(protest_geo_FlorAll_can$signif,
                protest_geo_Flornonad_can$signif,
                     protest_geo_Flortha_can$signif,
                     protest_geo_FlorLitt_can$signif,
                     protest_geo_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_geo_FlorAll_az$signif,
               protest_geo_Flornonad_az$signif,
                     protest_geo_Flortha_az$signif,
                     protest_geo_FlorLitt_az$signif,
                     protest_geo_FlorLitt.excl_az$signif)

corr_gal <- c(protest_geo_FlorAll_gal$t0,
              protest_geo_Flornonad_gal$t0,
                     protest_geo_Flortha_gal$t0,
                     protest_geo_FlorLitt_gal$t0,
                     protest_geo_FlorLitt.excl_gal$t0)

corr_can <- c(protest_geo_FlorAll_can$t0,
              protest_geo_Flornonad_can$t0,
                     protest_geo_Flortha_can$t0,
                     protest_geo_FlorLitt_can$t0,
                     protest_geo_FlorLitt.excl_can$t0)


corr_az <- c(protest_geo_FlorAll_az$t0,
             protest_geo_Flornonad_az$t0,
                     protest_geo_Flortha_az$t0,
                     protest_geo_FlorLitt_az$t0,
                     protest_geo_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_geo  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_geo)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_geo)=c("All","Nonad","Tha",
                                "Litt","Litt.excl")
results_procrustes1_geo 

write.csv(results_procrustes1_geo,"../Results/results_geo_floras.csv")

```


### Area and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Nonad", "Tha", "Litt","Litt.excl")



pvalue_gal <- c(protest_area_FlorAll_gal$signif,
                protest_area_Flornonad_gal$signif,
                     protest_area_Flortha_gal$signif,
                     protest_area_FlorLitt_gal$signif,
                     protest_area_FlorLitt.excl_gal$signif)

pvalue_can <- c(protest_area_FlorAll_can$signif,
                protest_area_Flornonad_can$signif,
                     protest_area_Flortha_can$signif,
                     protest_area_FlorLitt_can$signif,
                     protest_area_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_area_FlorAll_az$signif,
               protest_area_Flornonad_az$signif,
                     protest_area_Flortha_az$signif,
                     protest_area_FlorLitt_az$signif,
                     protest_area_FlorLitt.excl_az$signif)

corr_gal <- c(protest_area_FlorAll_gal$t0,
              protest_area_Flornonad_gal$t0,
                     protest_area_Flortha_gal$t0,
                     protest_area_FlorLitt_gal$t0,
                     protest_area_FlorLitt.excl_gal$t0)

corr_can <- c(protest_area_FlorAll_can$t0,
              protest_area_Flornonad_can$t0,
                     protest_area_Flortha_can$t0,
                     protest_area_FlorLitt_can$t0,
                     protest_area_FlorLitt.excl_can$t0)


corr_az <- c(protest_area_FlorAll_az$t0,
             protest_area_Flornonad_az$t0,
                     protest_area_Flortha_az$t0,
                     protest_area_FlorLitt_az$t0,
                     protest_area_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_area  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_area)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_area)=c("All","Nonad","Tha",
                                "Litt","Litt.excl")
results_procrustes1_area 

write.csv(results_procrustes1_area,"../Results/results_area_floras.csv")

```


### Age and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Nonad", "Tha", "Litt","Litt.excl")



pvalue_gal <- c(protest_age_FlorAll_gal$signif,
                protest_age_Flornonad_gal$signif,
                     protest_age_Flortha_gal$signif,
                     protest_age_FlorLitt_gal$signif,
                     protest_age_FlorLitt.excl_gal$signif)

pvalue_can <- c(protest_age_FlorAll_can$signif,
                protest_age_Flornonad_can$signif,
                     protest_age_Flortha_can$signif,
                     protest_age_FlorLitt_can$signif,
                     protest_age_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_age_FlorAll_az$signif,
               protest_age_Flornonad_az$signif,
                     protest_age_Flortha_az$signif,
                     protest_age_FlorLitt_az$signif,
                     protest_age_FlorLitt.excl_az$signif)

corr_gal <- c(protest_age_FlorAll_gal$t0,
              protest_age_Flornonad_gal$t0,
                     protest_age_Flortha_gal$t0,
                     protest_age_FlorLitt_gal$t0,
                     protest_age_FlorLitt.excl_gal$t0)

corr_can <- c(protest_age_FlorAll_can$t0,
              protest_age_Flornonad_can$t0,
                     protest_age_Flortha_can$t0,
                     protest_age_FlorLitt_can$t0,
                     protest_age_FlorLitt.excl_can$t0)


corr_az <- c(protest_age_FlorAll_az$t0,
             protest_age_Flornonad_az$t0,
                     protest_age_Flortha_az$t0,
                     protest_age_FlorLitt_az$t0,
                     protest_age_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_age  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_age)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_age)=c("All","Nonad","Tha",
                                "Litt","Litt.excl")
results_procrustes1_age 

write.csv(results_procrustes1_age,"../Results/results_age_floras.csv")

```




## Plot corr currents


```{r}



df_corr_currents <- results_procrustes1[,c("Gal.corr", "Gal.pval")]
df_corr_currents$flora <- rownames(df_corr_currents)
rownames(df_corr_currents) <- NULL
df_corr_currents$archipelago <- rep("Galapagos", times = nrow(df_corr_currents))
colnames(df_corr_currents) <- c("corr", "pval", "flora", "archipelago")


df_corr_currents_can <- results_procrustes1[,c("Can.corr", "Can.pval")]
df_corr_currents_can$flora <- rownames(df_corr_currents_can)
rownames(df_corr_currents_can) <- NULL
df_corr_currents_can$archipelago <- rep("Canaries", times = nrow(df_corr_currents_can))
colnames(df_corr_currents_can) <- c("corr", "pval", "flora", "archipelago")


df_corr_currents_az <- results_procrustes1[,c("Az.corr", "Az.pval")]
df_corr_currents_az$flora <- rownames(df_corr_currents_az)
rownames(df_corr_currents_az) <- NULL
df_corr_currents_az$archipelago <- rep("Azores", times = nrow(df_corr_currents_az))
colnames(df_corr_currents_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_currents <- rbind(df_corr_currents, df_corr_currents_can, df_corr_currents_az)


df_plot_corr_currents$sign <- with(df_plot_corr_currents, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_currents$archipelago <- factor(df_plot_corr_currents$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Nonad")] <- "Lowland"
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Litt")] <- "Littoral"
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_currents$flora <- factor(df_plot_corr_currents$flora, levels = c("All","Lowland", "Thalassochorous", "Littoral", "Littoral exclusive"))

df_plot_corr_currents <- df_plot_corr_currents[which(df_plot_corr_currents$flora != "All"),]

#saveRDS(df_plot_corr_currents, "df_plot_corr_currents.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_currents <- ggplot(df_plot_corr_currents, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey",size = 1.2) +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with currents connectivity")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme


plot_corr_currents
  
#ggsave("plot_corr_currents.png", height = 5, width = 9)
  

```


## Plot corr geographic distance


```{r}
df_corr_geo <- results_procrustes1_geo[,c("Gal.corr", "Gal.pval")]
df_corr_geo$flora <- rownames(df_corr_geo)
rownames(df_corr_geo) <- NULL
df_corr_geo$archipelago <- rep("Galapagos", times = nrow(df_corr_geo))
colnames(df_corr_geo) <- c("corr", "pval", "flora", "archipelago")

df_corr_geo_can <- results_procrustes1_geo[,c("Can.corr", "Can.pval")]
df_corr_geo_can$flora <- rownames(df_corr_geo_can)
rownames(df_corr_geo_can) <- NULL
df_corr_geo_can$archipelago <- rep("Canaries", times = nrow(df_corr_geo_can))
colnames(df_corr_geo_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_geo_az <- results_procrustes1_geo[,c("Az.corr", "Az.pval")]
df_corr_geo_az$flora <- rownames(df_corr_geo_az)
rownames(df_corr_geo_az) <- NULL
df_corr_geo_az$archipelago <- rep("Azores", times = nrow(df_corr_geo_az))
colnames(df_corr_geo_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_geo <- rbind(df_corr_geo, df_corr_geo_can, df_corr_geo_az)


df_plot_corr_geo$sign <- with(df_plot_corr_geo, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_geo$archipelago <- factor(df_plot_corr_geo$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Litt")] <- "Littoral"
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Nonad")] <- "Lowland"
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_geo$flora <- factor(df_plot_corr_geo$flora, levels = c("All","Lowland", "Thalassochorous", "Littoral", "Littoral exclusive"))

df_plot_corr_geo <- df_plot_corr_geo[which(df_plot_corr_geo$flora != "All"),]

#saveRDS(df_plot_corr_geo, "df_plot_corr_geo.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_geo <- ggplot(df_plot_corr_geo, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey",size = 1.2) +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with geographic distance")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_geo
  
#ggsave("plot_corr_geo.png", height = 5, width = 9)
  
```


## Plot corr area

```{r}
df_corr_area <- results_procrustes1_area[,c("Gal.corr", "Gal.pval")]
df_corr_area$flora <- rownames(df_corr_area)
rownames(df_corr_area) <- NULL
df_corr_area$archipelago <- rep("Galapagos", times = nrow(df_corr_area))
colnames(df_corr_area) <- c("corr", "pval", "flora", "archipelago")

df_corr_area_can <- results_procrustes1_area[,c("Can.corr", "Can.pval")]
df_corr_area_can$flora <- rownames(df_corr_area_can)
rownames(df_corr_area_can) <- NULL
df_corr_area_can$archipelago <- rep("Canaries", times = nrow(df_corr_area_can))
colnames(df_corr_area_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_area_az <- results_procrustes1_area[,c("Az.corr", "Az.pval")]
df_corr_area_az$flora <- rownames(df_corr_area_az)
rownames(df_corr_area_az) <- NULL
df_corr_area_az$archipelago <- rep("Azores", times = nrow(df_corr_area_az))
colnames(df_corr_area_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_area <- rbind(df_corr_area, df_corr_area_can, df_corr_area_az)


df_plot_corr_area$sign <- with(df_plot_corr_area, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_area$archipelago <- factor(df_plot_corr_area$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Litt")] <- "Littoral"
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Nonad")] <- "Lowland"
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_area$flora <- factor(df_plot_corr_area$flora, levels = c("All","Lowland", "Thalassochorous", "Littoral", "Littoral exclusive"))

df_plot_corr_area <- df_plot_corr_area[which(df_plot_corr_area$flora != "All"),]

#saveRDS(df_plot_corr_area, "df_plot_corr_area.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_area <- ggplot(df_plot_corr_area, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey",size = 1.2) +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with area")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_area
  
#ggsave("plot_corr_area.png", height = 5, width = 9)
```



## Plot corr island age

```{r}
df_corr_age <- results_procrustes1_age[,c("Gal.corr", "Gal.pval")]
df_corr_age$flora <- rownames(df_corr_age)
rownames(df_corr_age) <- NULL
df_corr_age$archipelago <- rep("Galapagos", times = nrow(df_corr_age))
colnames(df_corr_age) <- c("corr", "pval", "flora", "archipelago")

df_corr_age_can <- results_procrustes1_age[,c("Can.corr", "Can.pval")]
df_corr_age_can$flora <- rownames(df_corr_age_can)
rownames(df_corr_age_can) <- NULL
df_corr_age_can$archipelago <- rep("Canaries", times = nrow(df_corr_age_can))
colnames(df_corr_age_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_age_az <- results_procrustes1_age[,c("Az.corr", "Az.pval")]
df_corr_age_az$flora <- rownames(df_corr_age_az)
rownames(df_corr_age_az) <- NULL
df_corr_age_az$archipelago <- rep("Azores", times = nrow(df_corr_age_az))
colnames(df_corr_age_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_age <- rbind(df_corr_age, df_corr_age_can, df_corr_age_az)


df_plot_corr_age$sign <- with(df_plot_corr_age, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_age$archipelago <- factor(df_plot_corr_age$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Litt")] <- "Littoral"
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Nonad")] <- "Lowland"
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_age$flora <- factor(df_plot_corr_age$flora, levels = c("All","Lowland", "Thalassochorous", "Littoral", "Littoral exclusive"))

df_plot_corr_age <- df_plot_corr_age[which(df_plot_corr_age$flora != "All"),]

#saveRDS(df_plot_corr_age, "df_plot_corr_age.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))



plot_corr_age <- ggplot(df_plot_corr_age, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey", size = 1.2) +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with age")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_age
  
#ggsave("plot_corr_age.png", height = 5, width = 9)
```



```{r}

library(ggpubr)

ggarrange(
  plot_corr_currents,
  plot_corr_geo,
  plot_corr_area,
  plot_corr_age,
  common.legend = TRUE,
  labels = c("A", "B", "C", "D"),
  ncol = 2,
  nrow = 2,
  legend = "right"
  
)

ggsave("plots/plots_correlations.png", height = 11, width = 14)
```



## Plot current connectivities


```{r}


library(qgraph)

#### Galapagos

dist_gal <- 1/dist_curr_gal # one over, as qgraph takes similarity matrices as input



png('galapagos_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_gal, layout='spring', vsize=6.5, border.color = "blue", esize =40, edge.color = "blue", curveAll = TRUE)
dev.off()



#### Canaries

# Increase value between Fuerteventura and lanzarote as it is too small and makes it not possible to represent edges scales in the plot 
dist_curr_can_m <- as.matrix(dist_curr_can)
dist_curr_can_m[6,2] <- 100

dist_curr_can_d <- as.dist(dist_curr_can_m)

dist_can <- 1/dist_curr_can_d

png('canaries_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_can, layout='spring', vsize=6.5, border.color = "red", esize =40, edge.color = "red", curveAll = TRUE,minimum=0.0000000000)
dev.off()





#### Azores


# Increase value between PIC and FAI as it is too small and makes it not possible to represent edges scales in the plot 
dist_curr_az_m <- as.matrix(dist_curr_az)
dist_curr_az_m["PIC","FAI"] <- dist_curr_az_m["PIC","FAI"]+20
dist_curr_az_m["PIC","SJG"] <- dist_curr_az_m["PIC","SJG"]+20
dist_curr_az_m["COR","FLO"] <- dist_curr_az_m["COR","FLO"]+20

dist_curr_az_d <- as.dist(dist_curr_az_m)

dist_az <- 1/dist_curr_az_d

m <- as.matrix(dist_az)

png('azores_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_az, layout='spring', vsize=6.5, border.color = "green", esize =40, edge.color = "green", curveAll = TRUE,minimum=0.0000000000)
dev.off()


png('archipelagos_currents_qplot.png', width=5000, height=1800, unit='px')

par(mfrow = c(1,3))
qgraph(dist_gal, layout='spring', vsize=12, border.color = "blue", esize =40, edge.color = "blue", curveAll = TRUE,minimum=0.0000000000)
qgraph(dist_can, layout='spring', vsize=12, border.color = "red", esize =40, edge.color = "red", curveAll = TRUE,minimum=0.0000000000)
qgraph(dist_az, layout='spring', vsize=12, border.color = "green", esize =40, edge.color = "green", curveAll = TRUE,minimum=0.0000000000)

dev.off()

```



# Correlation currents with geo, area, age

```{r}

# corr with geo

protest_geo_curr_gal <-Compute_Protest_distMat(distMat_rot=dist_curr_gal,distMat_base = dist_geo_gal,k=11)

protest_geo_curr_can <-Compute_Protest_distMat(distMat_rot=dist_curr_can,distMat_base = dist_geo_can,k=6)

protest_geo_curr_az <-Compute_Protest_distMat(distMat_rot=dist_curr_az,distMat_base = dist_geo_az,k=8)

# corr with area

protest_area_curr_gal <-Compute_Protest_distMat(distMat_rot=dist_curr_gal,distMat_base = dist_area_gal,k=11)

protest_area_curr_can <-Compute_Protest_distMat(distMat_rot=dist_curr_can,distMat_base = dist_area_can,k=6)

protest_area_curr_az <-Compute_Protest_distMat(distMat_rot=dist_curr_az,distMat_base = dist_area_az,k=8)

# corr with age

protest_age_curr_gal <-Compute_Protest_distMat(distMat_rot=dist_curr_gal,distMat_base = dist_age_gal,k=11)

protest_age_curr_can <-Compute_Protest_distMat(distMat_rot=dist_curr_can,distMat_base = dist_age_can,k=6)

protest_age_curr_az <-Compute_Protest_distMat(distMat_rot=dist_curr_az,distMat_base = dist_age_az,k=8)

# Galapagos

corr <- c(protest_geo_curr_gal$t0,
          protest_area_curr_gal$t0,
          protest_age_curr_gal$t0)

sign <- c(protest_geo_curr_gal$signif,
          protest_area_curr_gal$signif,
          protest_age_curr_gal$signif)

df_gal <- data.frame(corr, sign)
df_gal$archipelago <- rep("Galapagos",nrow(df_gal))
df_gal$distance <- c("geographic dist", "area", "age")


# Canaries

corr <- c(protest_geo_curr_can$t0,
          protest_area_curr_can$t0,
          protest_age_curr_can$t0)

sign <- c(protest_geo_curr_can$signif,
          protest_area_curr_can$signif,
          protest_age_curr_can$signif)

df_can <- data.frame(corr, sign)
df_can$archipelago <- rep("Canaries",nrow(df_can))
df_can$distance <- c("geographic dist", "area", "age")

# Azores

corr <- c(protest_geo_curr_az$t0,
          protest_area_curr_az$t0,
          protest_age_curr_az$t0)

sign <- c(protest_geo_curr_az$signif,
          protest_area_curr_az$signif,
          protest_age_curr_az$signif)

df_az <- data.frame(corr, sign)
df_az$archipelago <- rep("Azores",nrow(df_az))
df_az$distance <- c("geographic dist", "area", "age")

df_corr_curr_rest <- rbind(df_gal, df_can, df_az)



df_corr_curr_rest$sign <- with(df_corr_curr_rest, ifelse(sign < 0.051, 'sign', 'non.sign'))

df_corr_curr_rest$archipelago <- factor(df_corr_curr_rest$archipelago, levels = c("Galapagos", "Canaries", "Azores"))

df_corr_curr_rest$distance <- factor(df_corr_curr_rest$distance, levels = c("geographic dist", "area", "age"))

plot_corr_curr_rest <- ggplot(df_corr_curr_rest, 
       aes(x = distance, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=distance ,xend=distance, y=0, yend=1), color="grey", size = 1.2) +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with sea current connectivity")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_curr_rest
  
ggsave("plot_corr_curr_rest.png", height = 5, width = 9)

```



# % THA and Litt with centrality by currents:


Summing up the edge weights of the adjacent edges for each vertex.

## obtain degrees

```{r}

library(igraph)
library(qgraph)



## Degree Galapagos

dist_curr_gal <- as.matrix(dist_curr_gal)
dist_curr_can <- as.matrix(dist_curr_can)
dist_curr_az <- as.matrix(dist_curr_az)

#dist_curr_gal <- as.matrix(dist_geo_gal)
#dist_curr_can <- as.matrix(dist_geo_can)
#dist_curr_az <- as.matrix(dist_geo_az)

con_curr_gal <- 1/dist_curr_gal
dist_curr_can <- 1/dist_curr_can
dist_curr_az <- 1/dist_curr_az

diag(con_curr_gal) <- 0
diag(dist_curr_can) <- 0
diag(dist_curr_az) <- 0




g_gal <- graph_from_adjacency_matrix(con_curr_gal, mode="undirected", weighted=TRUE)
g_can <- graph_from_adjacency_matrix(dist_curr_can, mode="undirected", weighted=TRUE)
g_az <- graph_from_adjacency_matrix(dist_curr_az, mode="undirected", weighted=TRUE)

## Normalize the weights

E(g_gal)$weight <- (E(g_gal)$weight-min(E(g_gal)$weight))/(max(E(g_gal)$weight)-min(E(g_gal)$weight))
E(g_can)$weight <- (E(g_can)$weight-min(E(g_can)$weight))/(max(E(g_can)$weight)-min(E(g_can)$weight))
E(g_az)$weight <- (E(g_az)$weight-min(E(g_az)$weight))/(max(E(g_az)$weight)-min(E(g_az)$weight))

degrees_gal <- strength(g_gal)
degrees_can <- strength(g_can)
degrees_az <- strength(g_az)



```



### Open Data

```{r}
data_Galapagos <- read_csv("../Data/Data_Galapagos/data_galapagos.csv", col_names = FALSE, trim_ws = TRUE)
data_Canaries <- read_csv("../Data/Data_Canaries/data_canaries.csv", col_names = FALSE, trim_ws = TRUE)
data_Azores <- read_csv("../Data/Data_Azores/data_azores.csv", col_names = FALSE)

df_Galapagos <- as.data.frame(data_Galapagos)
df_Canaries <- as.data.frame(data_Canaries)
df_Azores <- as.data.frame(data_Azores)


```



## Smooth the data frame

```{r}
df_Galapagos[is.na(df_Galapagos)] <- 0
df_Galapagos <- unite(df_Galapagos, name_species, c(X2, X3), remove=FALSE)
df_Galapagos <- df_Galapagos %>% select(1,2,5:29)


df_Canaries[is.na(df_Canaries)] <- 0

df_Azores[is.na(df_Azores)] <- 0

```




## Galapagos

```{r}
# m = matrix

df_Galapagos$name_species <- gsub('Sesuvium_edmondstonei', 'Sesuvium_edmonstonei', df_Galapagos$name_species)
# Sesuvium edmondstonei has been probably misspelled by the data set. There is a specie called Sesuvium edmonstonei, correctly descrived by Wiggins & Porter (1971), native from Galapagos Islands (Title of vols. 1-6 (1791-1802) Transactions of the Linnean Society; for series 2 see Trans. Linn. Soc. London) (it can also be checked on http://powo.science.kew.org/taxon/235141-2). So we have changed the data set to correct the species spelling.

df_Galapagos$name_species <- gsub('Pycreus_polystachyos', 'Cyperus_polystachyos', df_Galapagos$name_species)
# The specie Pycreus polystachyos, found in our data, is a synonim of Cyperus polystachyos, found in Wiggins & Porter (1971). The taxonomical correct name is Cyperus polystachyos Rottb., Descr. Pl. Rar. 21 (1772), because it is ancient than Pycreus polystachyos P.Beauv., Fl. Oware 2: 48, t. 86 (1816). So we have changed Pycreus polystachyos to Cyperus polystachyos on our data.

df_Galapagos <- subset(df_Galapagos, df_Galapagos$X4 %in% c("1", "habitats<500m")) # We filter only lowland species
df_Galapagos <- subset(df_Galapagos, df_Galapagos$X5 %in% c("Id", "En", "EnQ", "Sub-Origin"))   # From lowland species, we filter only native (and endemic) species


```



```{r}

# % tha

perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA")))/nrow(df_Galapagos)

esp_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X8 %in% "1"))/nrow(df_Galapagos)*100
fer_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X9 %in% "1"))/nrow(df_Galapagos)*100
flo_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X10 %in% "1"))/nrow(df_Galapagos)*100
  gen_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X11 %in% "1"))/nrow(df_Galapagos)*100
  isa_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X12 %in% "1"))/nrow(df_Galapagos)*100
  mar_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X13 %in% "1"))/nrow(df_Galapagos)*100
   pin_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X14 %in% "1"))/nrow(df_Galapagos)*100
   pinz_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X15 %in% "1"))/nrow(df_Galapagos)*100
   sanc_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X16 %in% "1"))/nrow(df_Galapagos)*100
   scz_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X17 %in% "1"))/nrow(df_Galapagos)*100
   sf_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X18 %in% "1"))/nrow(df_Galapagos)*100
   s_perc_tha_gal <- nrow(subset(df_Galapagos, df_Galapagos$X25 %in% c("0.5", "1", "THA") & df_Galapagos$X19 %in% "1"))/nrow(df_Galapagos)*100
   
   
   perc_tha_gal <- c(esp_perc_tha_gal, fer_perc_tha_gal, flo_perc_tha_gal,
                 gen_perc_tha_gal,isa_perc_tha_gal,mar_perc_tha_gal,
                 pin_perc_tha_gal,pinz_perc_tha_gal,sanc_perc_tha_gal,
                 scz_perc_tha_gal,sf_perc_tha_gal,s_perc_tha_gal)
   degrees_gal <- (degrees_gal-min(degrees_gal))/(max(degrees_gal)-min(degrees_gal))
   
   plot(degrees_gal, perc_tha_gal)
```

##### Canaries

```{r}
# m = matrix

df_Canaries <- subset(df_Canaries, df_Canaries$X3 %in% c("1", "habitat<500m")) # We filter only lowland species
df_Canaries <- subset(df_Canaries, df_Canaries$X4 %in% c("End", "NS", "NP", "status"))   # From lowland species, we filter only native (and endemic) species


hierro_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X6 %in% "1"))/nrow(df_Canaries)*100
palma_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X7 %in% "1"))/nrow(df_Canaries)*100
gom_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X8 %in% "1"))/nrow(df_Canaries)*100
ten_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X9 %in% "1"))/nrow(df_Canaries)*100
gc_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X10 %in% "1"))/nrow(df_Canaries)*100
fuert_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X11 %in% "1"))/nrow(df_Canaries)*100
lanz_perc_tha_can <- nrow(subset(df_Canaries, df_Canaries$X15 %in% c("0.5", "1", "thalassochory") & df_Canaries$X12 %in% "1"))/nrow(df_Canaries)*100


perc_tha_can <- c(hierro_perc_tha_can, fuert_perc_tha_can, gc_perc_tha_can, gom_perc_tha_can, palma_perc_tha_can, lanz_perc_tha_can, ten_perc_tha_can)

degrees_can <- (degrees_can-min(degrees_can))/(max(degrees_can)-min(degrees_can))

plot(degrees_can, perc_tha_can)

```


##### Azores

```{r}
# m = matrix

SMR_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X10 %in% "1"))/nrow(df_Azores)*100 
SMG_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X11 %in% "1"))/nrow(df_Azores)*100 
TER_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X12 %in% "1"))/nrow(df_Azores)*100 
GRA_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X13 %in% "1"))/nrow(df_Azores)*100 
SJG_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X14 %in% "1"))/nrow(df_Azores)*100 
PIC_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X15 %in% "1"))/nrow(df_Azores)*100 
FAI_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X16 %in% "1"))/nrow(df_Azores)*100 
FLO_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X17 %in% "1"))/nrow(df_Azores)*100 
COR_perc_tha_can <- nrow(subset(df_Azores, df_Azores$X7 %in% c("0.33", "0.5", "1", "THA") & df_Azores$X18 %in% "1"))/nrow(df_Azores)*100 


degrees_az

perc_tha_az <- c(COR_perc_tha_can, FAI_perc_tha_can, FLO_perc_tha_can, GRA_perc_tha_can, PIC_perc_tha_can, SJG_perc_tha_can, SMG_perc_tha_can, SMG_perc_tha_can, TER_perc_tha_can)




plot(degrees_az, perc_tha_az)

```



```{r}
degrees <- c(degrees_gal[-11], degrees_can, degrees_az)
archipelago <- (c(rep("Galapagos", times = length(degrees_gal[-11])),
              rep("Canaries", times = length(degrees_can)),
              rep("Azores", times = length(degrees_az))))
perc_tha <- c(perc_tha_gal[-11], perc_tha_can, perc_tha_az)

df_degree_tha <- data.frame(archipelago,degrees,perc_tha)



library(ggpubr)

df_degree_tha$archipelago <- factor(df_degree_tha$archipelago, levels = c("Galapagos", "Canaries", "Azores"))



plot_degree_tha <- ggscatter(df_degree_tha, x = "degrees", y = "perc_tha",color="archipelago", size=3,
                               add = "reg.line", conf.int = TRUE, 
                               cor.coef = TRUE, cor.method = "pearson",
                               xlab = "Weighted degree of geographic proximity", ylab = "% littoral and thalassochorous plants",
                               add.params = list(color = "gold4", fill = "lightgray"))+
  scale_color_manual(values = c("blue", "red", "green"))


plot_degree_geo

ggsave("plot_degree_tha_geo.png", height = 5, width = 6)

```


```{r}

```




