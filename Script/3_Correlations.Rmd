---
title: "Mantel test Galapagos - Floristic & Currents conectivity"
output:
  html_notebook: default
  word_document: default
Author: Alexandre Fuster and Guillem Pocull
---

In this script, we will convert the obtained floristic and currents matrices (floristic dissimilatiry matrix and oceanic current connectivity matrix) into distance matrices and perform a Procrustes analyses to explore their correlation and answer whether highly sea-current-connected islands more floristicaly similar. 

We will also analyze whether floristic similarities are related to geographic, area, and age distance between islands.

```{r}
library(ade4)
library(qgraph)
library(ecodist)
library(vegan)
library(tidyverse)
library(cluster)
library(textshape)
library(dplyr)
library(tidyverse)
library(cluster)
library(spaa)

source("../Script/Functions.R")
```


### Load data



#### Load floristic matrices and convert to distance objects

```{r}


# All species
distflor_all_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_gal")

distflor_all_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_can")

distflor_all_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_az")


# Thalassocorous

distflor_tha_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_thalassochory_gal")

distflor_tha_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_thalassochory_can")

distflor_tha_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_thalassochory_az")


# Fleshy fruited

distflor_freshy_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_fleshy_fruits_gal")


# Littoral

distflor_litt_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_littoral_gal")

distflor_litt_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_littoral_can")

distflor_litt_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_littoral_az")



# Littoral exclusive

distflor_litt.excl_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_littoral_exclusive_gal")

distflor_litt.excl_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_littoral_exclusive_can")

distflor_litt.excl_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_littoral_exclusive_az")



# All but thalassochorous

distflor_no.tha_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_thalassochory_gal")

distflor_no.tha_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_thalassochory_can")

distflor_no.tha_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_thalassochory_az")




# All but littoral

distflor_no.litt_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_littoral_gal")

distflor_no.litt_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_littoral_can")

distflor_no.litt_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_littoral_az")



# All but littoral exlusive

distflor_no.littexcl_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_littoral_exclusive_gal")

distflor_no.littexcl_can<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Canaries/df_all_without_littoral_exclusive_can")

distflor_no.littexcl_az<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Azores/df_all_without_littoral_exclusive_az")



 # All but fleshy fruited 

distflor_no.fleshy_gal<-load_order_convert_table_to_distanceMat(
  filepath="Dist_Matices_floras_Galapagos/df_all_without_fleshy_gal")



```



#### Load currents and geographic matrices and convert to distance objects

```{r}

# Currents distance matrix

dist_curr_gal<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Galapagos/Matrices-Currents_Galap/matrix_median_min_final_Galapagos.csv")

dist_curr_can<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Canaries/Matrices-Currents_Canaries/matrix_median_min_final_Canaries.csv")

dist_curr_az<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Azores/Matrices-Currents_Azores/matrix_median_min_final_Azores.csv")
  


dist_curr_gal<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Galapagos/Matrices-Currents_Galap/matrix_median_min_final_Galapagos.csv")

# Geographic distance matrix


dist_geo_gal<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Galapagos/Matrices-Geographic_Galap/geographic_distance_galap.csv")

dist_geo_can<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Canaries/Matrices-Geographic_Canaries/geographic_distance_canaries.csv")

dist_geo_az<-load_order_convert_csv_to_distanceMat(filepath ="../Matrices/Azores/Matrices-Geographic_Azores/geographic_distance_azores.csv")

```





#### Load island area matrices and convert to distance objects

Here we first open the file to calculate euclidean distances, and save it with write.table function to make it as we want

```{r}
df_area<-read.csv("../Data/Data_Galapagos/area_islands_galap.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Galapagos/Area_islands_Galapagos",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_gal<-read.table("../Data/Data_Galapagos/Area_islands_Galapagos")




df_area<-read.csv("../Data/Data_Canaries/area_islands_canaries.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Canaries/Area_islands_Canaries",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_can<-read.table("../Data/Data_Canaries/Area_islands_Canaries")





df_area<-read.csv("../Data/Data_Azores/area_islands_azores.csv")
df_area1<-column_to_rownames(df_area, 'X')

dist_area<-daisy(df_area1, metric="euclidean")

write.table(as.matrix(dist_area), file = "../Data/Data_Azores/Area_islands_Azores",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")

Area_islands_az<-read.table("../Data/Data_Azores/Area_islands_Azores")
```


```{r}
dist_area_gal<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Galapagos/Area_islands_Galapagos")

dist_area_can<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Canaries/Area_islands_Canaries")

dist_area_az<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Azores/Area_islands_Azores")
```




#### Load island age matrices and convert to distance objects

```{r}

df_Ages<-read.csv("../Data/Data_Galapagos/df_ages_Galap.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Galapagos/Ages_islands_Galapagos",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_gal<-read.table("../Data/Data_Galapagos/Ages_islands_Galapagos")




df_Ages<-read.csv("../Data/Data_Canaries/df_ages_canaries.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Canaries/Ages_islands_Canaries",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_can<-read.table("../Data/Data_Canaries/Ages_islands_Canaries")




df_Ages<-read.csv("../Data/Data_Azores/df_ages_azores.csv", sep=";")
df_Ages1<-column_to_rownames(df_Ages, 'island')

dist_Ages<-daisy(df_Ages1, metric="euclidean")

write.table(as.matrix(dist_Ages), file = "../Data/Data_Azores/Ages_islands_Azores",
            append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")


Ages_islands_az<-read.table("../Data/Data_Azores/Ages_islands_Azores")
```

```{r}
dist_age_gal<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Galapagos/Ages_islands_Galapagos")

dist_age_can<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Canaries/Ages_islands_Canaries")

dist_age_az<-load_order_convert_table_to_distanceMat(filepath = "../Data/Data_Azores/Ages_islands_Azores")
```






# Procrustes test




## Floras - currents

```{r}

# All species

protest_curr_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_curr_az,k=8)

# Thalassochorous

protest_curr_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_tha_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_curr_can, k=6)
protest_curr_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_curr_az,k=8)


# Littoral

protest_curr_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_curr_az,k=8)


# Littoral exclusive

protest_curr_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_curr_az,k=8)


# Fleshy fruitted

protest_curr_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_curr_gal,k=11)



# All but thalassochorous

protest_curr_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_curr_az,k=8)


# All but Littoral


protest_curr_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_curr_az,k=8)


# All but Littoral exclusive

protest_curr_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_curr_gal,k=11)
protest_curr_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_curr_can, k=6)
protest_curr_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_curr_az,k=8)



```


### Plot the results

This chunk saves procrustes tests in the local repository file "plots". It can be ignored for the analyses.


Plots are Kind 1, which gives a visual indication of the degree of match between the two ordinations. Symbols or labels show the position of the samples in the first ordination, and arrows point to their positions in the target ordination. The plot also shows the rotation between the two ordinations necessary to make them match as closely as possible


```{r}
  
# All

pdf(file= "plots/procrustes/protest_curr_FlorAll_gal.pdf" )
plot(protest_curr_FlorAll_gal, kind=1, type = "text",cex = 1.2, main = "Currents & All plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorAll_can.pdf" )
plot(protest_curr_FlorAll_can,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorAll_az.pdf" )
plot(protest_curr_FlorAll_az,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)




# Thalassochorous

pdf(file= "plots/procrustes/protest_curr_Flortha_gal.pdf" )
plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_Flortha_can.pdf" )
plot(protest_curr_Flortha_can,kind=1, type = "text",cex = 1.2,main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_Flortha_az.pdf" )
plot(protest_curr_Flortha_az,kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)


# Littoral

pdf(file= "plots/procrustes/protest_curr_FlorLitt_gal.pdf" )
plot(protest_curr_FlorLitt_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt_can.pdf" )
plot(protest_curr_FlorLitt_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt_az.pdf" )
plot(protest_curr_FlorLitt_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)


# Littoral exclusive

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_gal.pdf" )
plot(protest_curr_FlorLitt.excl_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_can.pdf" )
plot(protest_curr_FlorLitt.excl_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

pdf(file= "plots/procrustes/protest_curr_FlorLitt.excl_az.pdf" )
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)


# Fleshy fruited

pdf(file= "plots/procrustes/protest_curr_Florflesh_gal.pdf" )
plot(protest_curr_Florflesh_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Fleshy fruited plants", ar.col = "red1", len = 0.2)

```


Plots

```{r}
par(mfrow=c(2,3))

plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Florflesh_gal, kind=1, type = "text",cex = 1.2, main = "Currents & Fleshy fruited plants", ar.col = "red1", len = 0.2)
```


```{r}

par(mfrow=c(2,2))


plot(protest_curr_FlorAll_can,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_can,kind=1, type = "text",cex = 1.2,main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_can,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)

```

```{r}

par(mfrow=c(2,2))


plot(protest_curr_FlorAll_az,kind=1, type = "text",cex = 1.2,main = "Currents & All plants", ar.col = "red1", len = 0.2)
plot(protest_curr_Flortha_az,kind=1, type = "text",cex = 1.2, main = "Currents & Thalassochorous plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral plants", ar.col = "red1", len = 0.2)
plot(protest_curr_FlorLitt.excl_az,kind=1, type = "text",cex = 1.2,main = "Currents & Littoral exclusive plants", ar.col = "red1", len = 0.2)
```


## Floras - geo


```{r}
# All species

protest_geo_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_geo_az,k=8)

# Thalassochorous

protest_geo_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_geo_can, k=6)
protest_geo_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_geo_az,k=8)


# Littoral

protest_geo_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_geo_az,k=8)


# Littoral exclusive

protest_geo_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_geo_az,k=8)


# Fleshy fruitted

protest_geo_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_geo_gal,k=11)



# All but thalassochorous

protest_geo_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_geo_az,k=8)


# All but Littoral


protest_geo_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_geo_az,k=8)


# All but Littoral exclusive

protest_geo_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_geo_gal,k=11)
protest_geo_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_geo_can, k=6)
protest_geo_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_geo_az,k=8)

```




## Floras - Area

```{r}
# All species

protest_area_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_area_can, k=6)
protest_area_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_area_az,k=8)

# Thalassochorous

protest_area_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_area_gal,k=11)
protest_area_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_area_can, k=6)
protest_area_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_area_az,k=8)


# Littoral

protest_area_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_area_can, k=6)
protest_area_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_area_az,k=8)


# Littoral exclusive

protest_area_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_area_can, k=6)
protest_area_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_area_az,k=8)


# Fleshy fruitted

protest_area_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_area_gal,k=11)



# All but thalassochorous

protest_area_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_area_az,k=8)


# All but Littoral


protest_area_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_area_az,k=8)


# All but Littoral exclusive

protest_area_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_area_gal,k=11)
protest_area_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_area_can, k=6)
protest_area_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_area_az,k=8)

```


## Floras - Ages

```{r}
# All species

protest_age_FlorAll_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_age_gal ,k=11)
protest_age_FlorAll_can <-Compute_Protest_distMat(distMat_rot=distflor_all_can,distMat_base = dist_age_can, k=6)
protest_age_FlorAll_az <-Compute_Protest_distMat(distMat_rot=distflor_all_az,distMat_base = dist_age_az,k=8)

# Thalassochorous

protest_age_Flortha_gal <-Compute_Protest_distMat(distMat_rot=distflor_all_gal,distMat_base = dist_age_gal,k=11)
protest_age_Flortha_can <-Compute_Protest_distMat(distMat_rot=distflor_tha_can,distMat_base = dist_age_can, k=6)
protest_age_Flortha_az <-Compute_Protest_distMat(distMat_rot=distflor_tha_az,distMat_base = dist_age_az,k=8)


# Littoral

protest_age_FlorLitt_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorLitt_can <-Compute_Protest_distMat(distMat_rot=distflor_litt_can,distMat_base = dist_age_can, k=6)
protest_age_FlorLitt_az <-Compute_Protest_distMat(distMat_rot=distflor_litt_az,distMat_base = dist_age_az,k=8)


# Littoral exclusive

protest_age_FlorLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_can,distMat_base = dist_age_can, k=6)
protest_age_FlorLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_litt.excl_az,distMat_base = dist_age_az,k=8)


# Fleshy fruitted

protest_age_Florflesh_gal <-Compute_Protest_distMat(distMat_rot=distflor_freshy_gal,distMat_base = dist_age_gal,k=11)



# All but thalassochorous

protest_age_FlorNotha.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNotha.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNotha.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.tha_az,distMat_base = dist_age_az,k=8)


# All but Littoral


protest_age_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.litt_az,distMat_base = dist_age_az,k=8)


# All but Littoral exclusive

protest_age_FlorNoLitt.excl_gal <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_gal,distMat_base = dist_age_gal,k=11)
protest_age_FlorNoLitt.excl_can <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_can,distMat_base = dist_age_can, k=6)
protest_age_FlorNoLitt.excl_az <-Compute_Protest_distMat(distMat_rot=distflor_no.littexcl_az,distMat_base = dist_age_az,k=8)

```











## Results



###Currents and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Tha", "Litt","Litt.excl", "Fleshy")



pvalue_gal <- c(protest_curr_FlorAll_gal$signif,
                     protest_curr_Flortha_gal$signif,
                     protest_curr_FlorLitt_gal$signif,
                     protest_curr_FlorLitt.excl_gal$signif,
                     protest_curr_Florflesh_gal$signif)

pvalue_can <- c(protest_curr_FlorAll_can$signif,
                     protest_curr_Flortha_can$signif,
                     protest_curr_FlorLitt_can$signif,
                     protest_curr_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_curr_FlorAll_az$signif,
                     protest_curr_Flortha_az$signif,
                     protest_curr_FlorLitt_az$signif,
                     protest_curr_FlorLitt.excl_az$signif)

corr_gal <- c(protest_curr_FlorAll_gal$t0,
                     protest_curr_Flortha_gal$t0,
                     protest_curr_FlorLitt_gal$t0,
                     protest_curr_FlorLitt.excl_gal$t0,
                     protest_curr_Florflesh_gal$t0)

corr_can <- c(protest_curr_FlorAll_can$t0,
                     protest_curr_Flortha_can$t0,
                     protest_curr_FlorLitt_can$t0,
                     protest_curr_FlorLitt.excl_can$t0)


corr_az <- c(protest_curr_FlorAll_az$t0,
                     protest_curr_Flortha_az$t0,
                     protest_curr_FlorLitt_az$t0,
                     protest_curr_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1)=c("All","Tha",
                                "Litt","Litt.excl",
                                "Fleshy")
results_procrustes1 

#write.csv(results_procrustes1,"../Results/results_currents_floras.csv")

```


### Geo and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Tha", "Litt","Litt.excl", "Fleshy")



pvalue_gal <- c(protest_geo_FlorAll_gal$signif,
                     protest_geo_Flortha_gal$signif,
                     protest_geo_FlorLitt_gal$signif,
                     protest_geo_FlorLitt.excl_gal$signif,
                     protest_geo_Florflesh_gal$signif)

pvalue_can <- c(protest_geo_FlorAll_can$signif,
                     protest_geo_Flortha_can$signif,
                     protest_geo_FlorLitt_can$signif,
                     protest_geo_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_geo_FlorAll_az$signif,
                     protest_geo_Flortha_az$signif,
                     protest_geo_FlorLitt_az$signif,
                     protest_geo_FlorLitt.excl_az$signif)

corr_gal <- c(protest_geo_FlorAll_gal$t0,
                     protest_geo_Flortha_gal$t0,
                     protest_geo_FlorLitt_gal$t0,
                     protest_geo_FlorLitt.excl_gal$t0,
                     protest_geo_Florflesh_gal$t0)

corr_can <- c(protest_geo_FlorAll_can$t0,
                     protest_geo_Flortha_can$t0,
                     protest_geo_FlorLitt_can$t0,
                     protest_geo_FlorLitt.excl_can$t0)


corr_az <- c(protest_geo_FlorAll_az$t0,
                     protest_geo_Flortha_az$t0,
                     protest_geo_FlorLitt_az$t0,
                     protest_geo_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_geo  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_geo)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_geo)=c("All","Tha",
                                "Litt","Litt.excl",
                                "Fleshy")
results_procrustes1_geo 

write.csv(results_procrustes1_geo,"../Results/results_geo_floras.csv")

```


### Area and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Tha", "Litt","Litt.excl", "Fleshy")



pvalue_gal <- c(protest_area_FlorAll_gal$signif,
                     protest_area_Flortha_gal$signif,
                     protest_area_FlorLitt_gal$signif,
                     protest_area_FlorLitt.excl_gal$signif,
                     protest_area_Florflesh_gal$signif)

pvalue_can <- c(protest_area_FlorAll_can$signif,
                     protest_area_Flortha_can$signif,
                     protest_area_FlorLitt_can$signif,
                     protest_area_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_area_FlorAll_az$signif,
                     protest_area_Flortha_az$signif,
                     protest_area_FlorLitt_az$signif,
                     protest_area_FlorLitt.excl_az$signif)

corr_gal <- c(protest_area_FlorAll_gal$t0,
                     protest_area_Flortha_gal$t0,
                     protest_area_FlorLitt_gal$t0,
                     protest_area_FlorLitt.excl_gal$t0,
                     protest_area_Florflesh_gal$t0)

corr_can <- c(protest_area_FlorAll_can$t0,
                     protest_area_Flortha_can$t0,
                     protest_area_FlorLitt_can$t0,
                     protest_area_FlorLitt.excl_can$t0)


corr_az <- c(protest_area_FlorAll_az$t0,
                     protest_area_Flortha_az$t0,
                     protest_area_FlorLitt_az$t0,
                     protest_area_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_area  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_area)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_area)=c("All","Tha",
                                "Litt","Litt.excl",
                                "Fleshy")
results_procrustes1_area 

write.csv(results_procrustes1_area,"../Results/results_area_floras.csv")

```


### Age and floristic connectivities


```{r}

Name_columns <- c("Galapagos", "Canaries", "Azores")
Name_rows <- c("All", "Tha", "Litt","Litt.excl", "Fleshy")



pvalue_gal <- c(protest_age_FlorAll_gal$signif,
                     protest_age_Flortha_gal$signif,
                     protest_age_FlorLitt_gal$signif,
                     protest_age_FlorLitt.excl_gal$signif,
                     protest_age_Florflesh_gal$signif)

pvalue_can <- c(protest_age_FlorAll_can$signif,
                     protest_age_Flortha_can$signif,
                     protest_age_FlorLitt_can$signif,
                     protest_age_FlorLitt.excl_can$signif)

pvalue_az <- c(protest_age_FlorAll_az$signif,
                     protest_age_Flortha_az$signif,
                     protest_age_FlorLitt_az$signif,
                     protest_age_FlorLitt.excl_az$signif)

corr_gal <- c(protest_age_FlorAll_gal$t0,
                     protest_age_Flortha_gal$t0,
                     protest_age_FlorLitt_gal$t0,
                     protest_age_FlorLitt.excl_gal$t0,
                     protest_age_Florflesh_gal$t0)

corr_can <- c(protest_age_FlorAll_can$t0,
                     protest_age_Flortha_can$t0,
                     protest_age_FlorLitt_can$t0,
                     protest_age_FlorLitt.excl_can$t0)


corr_az <- c(protest_age_FlorAll_az$t0,
                     protest_age_Flortha_az$t0,
                     protest_age_FlorLitt_az$t0,
                     protest_age_FlorLitt.excl_az$t0)

length(pvalue_can) <- length(pvalue_gal)
length(pvalue_az) <- length(pvalue_gal)
length(corr_can) <- length(pvalue_gal)
length(corr_az) <- length(pvalue_gal)



results_procrustes  <- data.frame(corr_gal,pvalue_gal,corr_can,pvalue_can,corr_az,pvalue_az)

results_procrustes1_age  <-results_procrustes %>% 
  mutate_if(is.numeric, round, digits=4)

colnames(results_procrustes1_age)=c("Gal.corr","Gal.pval",
                                "Can.corr","Can.pval", 
                                "Az.corr", "Az.pval")

rownames(results_procrustes1_age)=c("All","Tha",
                                "Litt","Litt.excl",
                                "Fleshy")
results_procrustes1_age 

write.csv(results_procrustes1_age,"../Results/results_age_floras.csv")

```




## Plot corr currents


```{r}



df_corr_currents <- results_procrustes1[,c("Gal.corr", "Gal.pval")]
df_corr_currents$flora <- rownames(df_corr_currents)
rownames(df_corr_currents) <- NULL
df_corr_currents <- df_corr_currents[-(which(df_corr_currents$flora == "Fleshy")),]
df_corr_currents$archipelago <- rep("Galapagos", times = nrow(df_corr_currents))
colnames(df_corr_currents) <- c("corr", "pval", "flora", "archipelago")

df_corr_currents_can <- results_procrustes1[,c("Can.corr", "Can.pval")]
df_corr_currents_can$flora <- rownames(df_corr_currents_can)
rownames(df_corr_currents_can) <- NULL
df_corr_currents_can <- df_corr_currents_can[-(which(df_corr_currents_can$flora == "Fleshy")),]
df_corr_currents_can$archipelago <- rep("Canaries", times = nrow(df_corr_currents_can))
colnames(df_corr_currents_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_currents_az <- results_procrustes1[,c("Az.corr", "Az.pval")]
df_corr_currents_az$flora <- rownames(df_corr_currents_az)
rownames(df_corr_currents_az) <- NULL
df_corr_currents_az <- df_corr_currents_az[-(which(df_corr_currents_az$flora == "Fleshy")),]
df_corr_currents_az$archipelago <- rep("Azores", times = nrow(df_corr_currents_az))
colnames(df_corr_currents_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_currents <- rbind(df_corr_currents, df_corr_currents_can, df_corr_currents_az)


df_plot_corr_currents$sign <- with(df_plot_corr_currents, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_currents$archipelago <- factor(df_plot_corr_currents$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Litt")] <- "Littoral"
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_currents$flora[which(df_plot_corr_currents$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_currents$flora <- factor(df_plot_corr_currents$flora, levels = c("All", "Thalassochorous", "Littoral", "Littoral exclusive"))

#saveRDS(df_plot_corr_currents, "df_plot_corr_currents.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_currents <- ggplot(df_plot_corr_currents, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey") +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with currents connectivity")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  
#ggsave("plot_corr_currents.png", height = 5, width = 9)
  

```


## Plot corr geographic distance


```{r}
df_corr_geo <- results_procrustes1_geo[,c("Gal.corr", "Gal.pval")]
df_corr_geo$flora <- rownames(df_corr_geo)
rownames(df_corr_geo) <- NULL
df_corr_geo <- df_corr_geo[-(which(df_corr_geo$flora == "Fleshy")),]
df_corr_geo$archipelago <- rep("Galapagos", times = nrow(df_corr_geo))
colnames(df_corr_geo) <- c("corr", "pval", "flora", "archipelago")

df_corr_geo_can <- results_procrustes1_geo[,c("Can.corr", "Can.pval")]
df_corr_geo_can$flora <- rownames(df_corr_geo_can)
rownames(df_corr_geo_can) <- NULL
df_corr_geo_can <- df_corr_geo_can[-(which(df_corr_geo_can$flora == "Fleshy")),]
df_corr_geo_can$archipelago <- rep("Canaries", times = nrow(df_corr_geo_can))
colnames(df_corr_geo_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_geo_az <- results_procrustes1_geo[,c("Az.corr", "Az.pval")]
df_corr_geo_az$flora <- rownames(df_corr_geo_az)
rownames(df_corr_geo_az) <- NULL
df_corr_geo_az <- df_corr_geo_az[-(which(df_corr_geo_az$flora == "Fleshy")),]
df_corr_geo_az$archipelago <- rep("Azores", times = nrow(df_corr_geo_az))
colnames(df_corr_geo_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_geo <- rbind(df_corr_geo, df_corr_geo_can, df_corr_geo_az)


df_plot_corr_geo$sign <- with(df_plot_corr_geo, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_geo$archipelago <- factor(df_plot_corr_geo$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Litt")] <- "Littoral"
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_geo$flora[which(df_plot_corr_geo$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_geo$flora <- factor(df_plot_corr_geo$flora, levels = c("All", "Thalassochorous", "Littoral", "Littoral exclusive"))

#saveRDS(df_plot_corr_geo, "df_plot_corr_geo.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_geo <- ggplot(df_plot_corr_geo, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey") +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with geographic distance")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_geo
#ggsave("plot_corr_geo.png", height = 5, width = 9)
  
```


## Plot corr area

```{r}
df_corr_area <- results_procrustes1_area[,c("Gal.corr", "Gal.pval")]
df_corr_area$flora <- rownames(df_corr_area)
rownames(df_corr_area) <- NULL
df_corr_area <- df_corr_area[-(which(df_corr_area$flora == "Fleshy")),]
df_corr_area$archipelago <- rep("Galapagos", times = nrow(df_corr_area))
colnames(df_corr_area) <- c("corr", "pval", "flora", "archipelago")

df_corr_area_can <- results_procrustes1_area[,c("Can.corr", "Can.pval")]
df_corr_area_can$flora <- rownames(df_corr_area_can)
rownames(df_corr_area_can) <- NULL
df_corr_area_can <- df_corr_area_can[-(which(df_corr_area_can$flora == "Fleshy")),]
df_corr_area_can$archipelago <- rep("Canaries", times = nrow(df_corr_area_can))
colnames(df_corr_area_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_area_az <- results_procrustes1_area[,c("Az.corr", "Az.pval")]
df_corr_area_az$flora <- rownames(df_corr_area_az)
rownames(df_corr_area_az) <- NULL
df_corr_area_az <- df_corr_area_az[-(which(df_corr_area_az$flora == "Fleshy")),]
df_corr_area_az$archipelago <- rep("Azores", times = nrow(df_corr_area_az))
colnames(df_corr_area_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_area <- rbind(df_corr_area, df_corr_area_can, df_corr_area_az)


df_plot_corr_area$sign <- with(df_plot_corr_area, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_area$archipelago <- factor(df_plot_corr_area$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Litt")] <- "Littoral"
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_area$flora[which(df_plot_corr_area$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_area$flora <- factor(df_plot_corr_area$flora, levels = c("All", "Thalassochorous", "Littoral", "Littoral exclusive"))

#saveRDS(df_plot_corr_area, "df_plot_corr_area.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))

plot_corr_area <- ggplot(df_plot_corr_area, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey") +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with area")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_area
#ggsave("plot_corr_area.png", height = 5, width = 9)
```



## Plot corr island age

```{r}
df_corr_age <- results_procrustes1_age[,c("Gal.corr", "Gal.pval")]
df_corr_age$flora <- rownames(df_corr_age)
rownames(df_corr_age) <- NULL
df_corr_age <- df_corr_age[-(which(df_corr_age$flora == "Fleshy")),]
df_corr_age$archipelago <- rep("Galapagos", times = nrow(df_corr_age))
colnames(df_corr_age) <- c("corr", "pval", "flora", "archipelago")

df_corr_age_can <- results_procrustes1_age[,c("Can.corr", "Can.pval")]
df_corr_age_can$flora <- rownames(df_corr_age_can)
rownames(df_corr_age_can) <- NULL
df_corr_age_can <- df_corr_age_can[-(which(df_corr_age_can$flora == "Fleshy")),]
df_corr_age_can$archipelago <- rep("Canaries", times = nrow(df_corr_age_can))
colnames(df_corr_age_can) <- c("corr", "pval", "flora", "archipelago")

df_corr_age_az <- results_procrustes1_age[,c("Az.corr", "Az.pval")]
df_corr_age_az$flora <- rownames(df_corr_age_az)
rownames(df_corr_age_az) <- NULL
df_corr_age_az <- df_corr_age_az[-(which(df_corr_age_az$flora == "Fleshy")),]
df_corr_age_az$archipelago <- rep("Azores", times = nrow(df_corr_age_az))
colnames(df_corr_age_az) <- c("corr", "pval", "flora", "archipelago")


df_plot_corr_age <- rbind(df_corr_age, df_corr_age_can, df_corr_age_az)


df_plot_corr_age$sign <- with(df_plot_corr_age, ifelse(pval < 0.051, 'sign', 'non.sign'))

df_plot_corr_age$archipelago <- factor(df_plot_corr_age$archipelago, levels = c("Galapagos", "Canaries", "Azores"))
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Litt")] <- "Littoral"
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Litt.excl")] <- "Littoral exclusive"
df_plot_corr_age$flora[which(df_plot_corr_age$flora == "Tha")] <- "Thalassochorous"


df_plot_corr_age$flora <- factor(df_plot_corr_age$flora, levels = c("All", "Thalassochorous", "Littoral", "Littoral exclusive"))

#saveRDS(df_plot_corr_age, "df_plot_corr_age.rds")

my.theme<-theme(axis.text=element_text(size=15),
        axis.title = element_text(size = 17),
        legend.text=element_text(size=10),
        legend.title = element_text(size=12),
        plot.title = element_text(face="bold",size=14,margin=margin(0,0,20,0),hjust = 0.5),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.background = element_rect(fill = 'white'))



plot_corr_age <- ggplot(df_plot_corr_age, 
       aes(x = flora, y = corr, group = archipelago, shape = sign, fill = archipelago))+
 geom_segment( aes(x=flora ,xend=flora, y=0, yend=1), color="grey") +
  geom_point(aes(color = archipelago),size = 5, alpha = 0.8,stroke = 2) + #alpha = 0.8, 
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="right"
    ) +
    xlab("")+
    ylab("correlation with age")+
  ylim(0,1)   +
  scale_color_manual(values = c("blue", "red", "green"))+
  scale_shape_manual(values = c(1, 19))+
  theme_bw()+
  my.theme

  plot_corr_age
#ggsave("plot_corr_age.png", height = 5, width = 9)
```



```{r}

library(ggpubr)

ggarrange(
  plot_corr_currents,
  plot_corr_geo,
  plot_corr_area,
  plot_corr_age,
  common.legend = TRUE,
  labels = c("A", "B", "C", "D"),
  ncol = 2,
  nrow = 2,
  legend = "right"
  
)

#ggsave("plots/plots_correlations.png", height = 11, width = 14)
```



## Plot current connectivities


```{r}


library(qgraph)

#### Galapagos

dist_gal <- 1/dist_curr_gal # one over, as qgraph takes similarity matrices as input



png('galapagos_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_gal, layout='spring', vsize=6.5, border.color = "blue", esize =40, edge.color = "blue", curveAll = TRUE)
dev.off()



#### Canaries

# Increase value between Fuerteventura and lanzarote as it is too small and makes it not possible to represent edges scales in the plot 
dist_curr_can_m <- as.matrix(dist_curr_can)
dist_curr_can_m[6,2] <- 100

dist_curr_can_d <- as.dist(dist_curr_can_m)

dist_can <- 1/dist_curr_can_d

png('canaries_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_can, layout='spring', vsize=6.5, border.color = "red", esize =40, edge.color = "red", curveAll = TRUE,minimum=0.0000000000)
dev.off()





#### Azores


# Increase value between PIC and FAI as it is too small and makes it not possible to represent edges scales in the plot 
dist_curr_az_m <- as.matrix(dist_curr_az)
dist_curr_az_m["PIC","FAI"] <- dist_curr_az_m["PIC","FAI"]+20
dist_curr_az_m["PIC","SJG"] <- dist_curr_az_m["PIC","SJG"]+20
dist_curr_az_m["COR","FLO"] <- dist_curr_az_m["COR","FLO"]+20

dist_curr_az_d <- as.dist(dist_curr_az_m)

dist_az <- 1/dist_curr_az_d

m <- as.matrix(dist_az)

png('azores_currents_qplot.png', width=1000, height=1000, unit='px')
qgraph(dist_az, layout='spring', vsize=6.5, border.color = "green", esize =40, edge.color = "green", curveAll = TRUE,minimum=0.0000000000)
dev.off()


png('archipelagos_currents_qplot.png', width=5000, height=1800, unit='px')

par(mfrow = c(1,3))
qgraph(dist_gal, layout='spring', vsize=12, border.color = "blue", esize =40, edge.color = "blue", curveAll = TRUE,minimum=0.0000000000)
qgraph(dist_can, layout='spring', vsize=12, border.color = "red", esize =40, edge.color = "red", curveAll = TRUE,minimum=0.0000000000)
qgraph(dist_az, layout='spring', vsize=12, border.color = "green", esize =40, edge.color = "green", curveAll = TRUE,minimum=0.0000000000)

dev.off()

```


